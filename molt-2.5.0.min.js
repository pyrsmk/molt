(function(def){if(typeof define=="function"){define(def)}else if(typeof module!="undefined"){module.exports=def}else{this.molt=def}})(function(){var getAttribute="getAttribute",data="data-",triggers=[],listeners=[],nodes=[],i,refresh=function(){var j,k,url,node,mode,modes,width=W();i=-1;while(node=nodes[++i]){modes=(url=node.getAttribute(data+"url")).match(/\{\s*(.*?)\s*\}/)[1].split(/\s*,\s*/);j=modes.length;while(j--){mode=modes[j].split(":");if(mode.length==1){mode[1]=mode[0]}if(width>mode[0].match(/^!?(.+)/)[1]){break}}if(mode[0].charAt(0)=="!"){node.style.display="none"}else{if(node.style.display=="none"){if(k=node.getAttribute(data+"display")){node.style.display=k}else{node.style.display="inline"}}node.src=url.replace(/\{.+\}/g,mode[1]);k=triggers.length;while(k--){if(triggers[k]==node){listeners[k].apply(node,[mode[1]])}}}}};return{listen:function(node,callback){triggers.push(node);listeners.push(callback)},discover:function(){var img,imgs=document.getElementsByTagName("img"),discovered="discovered";i=-1;while(img=imgs[++i]){if(img[getAttribute](data+"url")&&!img[getAttribute](data+discovered)){img.setAttribute(data+discovered,discovered);nodes.push(img)}}refresh();W(refresh);return nodes}}}());